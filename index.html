<!DOCTYPE HTML>
<html>
<head>		
	<style>
		body {
			background-color: #000000;
			color: #ffffff;
			text-align: center;
		}
		.girls {
			font-family: "Courier New", monospace;
			font-size: 12px;
		}
		.uiBox {
			font-family: "Courier New", monospace;
			font-size: 12px;
			margin: 0;
			position: relative;
			top: -6em;
		}
		.lenny {
			font-family: Arial;
			font-size: 2em;
		}
		.opaque {
			background-color: #000000;
		}
	</style>
	<script type="text/javascript" src="senisoshitsu.js">
	</script>
	<script type="text/javascript">
	ramp = '       .........,,,,,,,:::::::;;;;;;;;rrrrrrriiiiiiiii7777777XXXXXXXXXXXSSSSSSS2222222aaaaaaZZZZZZZZZZ888888800000000BBBBBBBBWWWWWWWWW@@@@@@@MMMMMMM';

	ansiColors = [[170, 0, 0],[0,170,0],[170,85,0],[0,0,170],[170,0,170],[0,170,170],[85,85,85],[255,85,85],[85,255,85],[255,255,85],[85,85,255],[255,85,255],[85,255,255],[255,255,255]];
	
	ansiNoGray = [[170, 0, 0],[0,170,0],[170,85,0],[0,0,170],[170,0,170],[0,170,170],[255,85,85],[85,255,85],[255,255,85],[85,85,255],[255,85,255],[85,255,255],[255,255,255]];

	ansiNoWhite = [[170, 0, 0],[0,170,0],[170,85,0],[0,0,170],[170,0,170],[0,170,170],[255,85,85],[85,255,85],[255,255,85],[85,85,255],[255,85,255],[85,255,255]];

	testPalette = [[150, 0, 0],[0,0,150]];

	rgbPalette = [[170, 0,0],[0,170,0],[0,0,170]];

	c = new Canvas('girls', ramp, ansiNoGray, rgbDistance);

	function compositeG(bg, currentG, gWidth, vOffset) {
		var composite = new Uint8Array(bg);
		var width = bg[4];
		if (currentG.length != 0) var partitionSize = width / currentG.length;

		for(i in currentG) {
			composite = compositeImages(composite, currentG[i].byteArray, Math.round((i * partitionSize) + (partitionSize / 2) - (gWidth / 2)), vOffset);
		}
		return composite;
	}

	function compositeTransition(bg, currentG, gWidth, vOffset, textBoxEnabled, callback) {
		if(callback === undefined) callback = function(){};
		var newImage = compositeG(bg, currentG, gWidth, vOffset);
		if(textBoxEnabled) newImage = compositeImages(newImage, textBox['trans'], 0, 42);
		var interval = c.shittyTransition(newImage, 1, callback);
		console.log(interval);
		lock = false;
		return newImage;
	}

	function compareG(g1, g2) {
		switch (g1.name < g2.name) {
			case false:
				return 1;
			case true: 
				return -1;
		}
	}

	function toggleG(currentG, toggledG, gStack) {
		for(i in currentG) {
			if (currentG[i].name == toggledG) {
				currentG.splice(i, 1);
				for(j in gStack) {
					if (gStack[j] == toggledG) gStack.splice(j, 1);
				}
				return;
			}
		}
		currentG.push({name: toggledG, byteArray: g[toggledG]});
		gStack.push(toggledG);
		currentG.sort(compareG);

	}

	function toggleRender(toggledG) {
		toggleG(currentG, toggledG, gStack);
		compositeTransition(currentBg, currentG, 120, 5, textBoxEnabled, function(){
			for(var i in c.currentTextLocations) {
				c.removeText(i);
			}
			if(gStack.length !== 0 && textBoxEnabled) {
				c.insertWrappedText(gText[gStack[gStack.length - 1]]['name'], 'name', 4, 44, 167, 1, true);
				c.insertWrappedText(gText[gStack[gStack.length - 1]]['line'], 'line', 4, 48, 167, 1, false);
			}
		});
	}

	function switchBg(bgName) {
		currentBg = bg[bgName];
		compositeTransition(currentBg, currentG, 120, 5, textBoxEnabled);
	}

	function toggleTextBox() {
		if (!textBoxEnabled) {
			var newImage = compositeImages(c.currentImage, textBox['trans'], 0, 42);
			c.shittyTransition(newImage, 99999, function(){
				if(gStack.length !== 0) {
					c.insertWrappedText(gText[gStack[gStack.length - 1]]['name'], 'name', 4, 44, 167, 1, true);
					c.insertWrappedText(gText[gStack[gStack.length - 1]]['line'], 'line', 4, 48, 167, 1, true);
				}
			});
			textBoxEnabled = true;
		}
		else {
			var newImage = compositeG(currentBg, currentG, 120, 5);
			c.shittyTransition(newImage, 99999, function(){
				for(var i in c.currentTextLocations) {
					c.removeText(i);
				}
			});
			textBoxEnabled = false;
		}
	}

	gStack = Array();
	gText = {
		g1 : {name : "SUBJECT 1", line : "Google employees, interns, contractors, or family members thereof; or residents and/or nationals of Iran, Syria, Cuba, Sudan, North Korea and Myanmar (Burma), with whom we are prohibited by U.S. law from engaging in commerce, are ineligible to participate. Please also note that any residents of Argentina, Belarus, Brazil, Chile, Colombia, Kazakhstan, Mexico, Peru, Russia, and Ukraine that participate in the program will not receive a t-shirt or any promotional items for their participation."},
		g2 : {name : "SUBJECT 2", line : "lel"},
		g3 : {name : "SUBJECT 3", line : "lel"},
		g4 : {name : "SUBJECT 4", line : "lel"},
		g5 : {name : "SUBJECT 5", line : "lel"},
	};
	textBoxEnabled = false;
	bg = {};
	g = {};
	textBox = {};
	loadImage('bg1', bg, function(){
		c.renderCanvas(bg['bg1']);
		currentBg = bg['bg1'];
		currentG = new Array();
	});
	loadImage('bg2', bg);
	loadImage('bg4', bg);
	loadImage('bg5', bg);
	loadImage('bgs', bg);
	loadImage('g1', g);
	loadImage('g2', g);
	loadImage('g3', g);
	loadImage('g4', g);
	loadImage('g5', g);
	loadImage('trans', textBox);

	window.onkeydown = function(e){
		if(!(c.transitionLock || c.textLock)){
			switch(e.keyCode){
				case 49:
					switchBg('bg1');
					break;
				case 50:
					switchBg('bg2');
					break;
				case 51:
					switchBg('bg4');
					break;
				case 52:
					switchBg('bg5');
					break;
				case 53:
					switchBg('bgs');
					break;
				case 54:
					toggleRender('g1');
					break;
				case 55:
					toggleRender('g2');
					break;
				case 56:
					toggleRender('g3');
					break;
				case 57:
					toggleRender('g4');
					break;
				case 48:
					toggleRender('g5');
					break;
				case 84:
					toggleTextBox();
					break;
			}
		}
	};
	</script>
</head>
<body>
	<div id="girls">
		<pre></pre>
	</div>
</body>
</html>