<!DOCTYPE HTML>
<html>
<head>		
	<style>
		body {
			background-color: #000000;
			color: #ffffff;
			text-align: center;
		}
		.girls {
			font-family: "Courier New", monospace;
			font-size: 12px;
		}
		.uiBox {
			font-family: "Courier New", monospace;
			font-size: 12px;
			margin: 0;
			position: relative;
			top: -6em;
		}
		.lenny {
			font-family: Arial;
			font-size: 2em;
		}
		.opaque {
			background-color: #000000;
		}
	</style>
	<script type="text/javascript" src="senisoshitsu.js">
	</script>
	<script type="text/javascript">
	ramp = '       .........,,,,,,,:::::::;;;;;;;;rrrrrrriiiiiiiii7777777XXXXXXXXXXXSSSSSSS2222222aaaaaaZZZZZZZZZZ888888800000000BBBBBBBBWWWWWWWWW@@@@@@@MMMMMMM';

	ansiColors = [[170, 0, 0],[0,170,0],[170,85,0],[0,0,170],[170,0,170],[0,170,170],[85,85,85],[255,85,85],[85,255,85],[255,255,85],[85,85,255],[255,85,255],[85,255,255],[255,255,255]];
	
	ansiNoGray = [[170, 0, 0],[0,170,0],[170,85,0],[0,0,170],[170,0,170],[0,170,170],[255,85,85],[85,255,85],[255,255,85],[85,85,255],[255,85,255],[85,255,255],[255,255,255]];

	ansiNoWhite = [[170, 0, 0],[0,170,0],[170,85,0],[0,0,170],[170,0,170],[0,170,170],[255,85,85],[85,255,85],[255,255,85],[85,85,255],[255,85,255],[85,255,255]];

	testPalette = [[150, 0, 0],[0,0,150]];

	rgbPalette = [[170, 0,0],[0,170,0],[0,0,170]];

	c = new Canvas('girls', ramp, ansiNoGray, rgbDistance);

	function compositeG(bg, currentG, gWidth, vOffset) {
		var composite = new Uint8Array(bg);
		var width = bg[4];
		if (currentG.length != 0) var partitionSize = width / currentG.length;

		for(i in currentG) {
			composite = compositeImages(composite, currentG[i].byteArray, Math.round((i * partitionSize) + (partitionSize / 2) - (gWidth / 2)), vOffset);
		}
		return composite;
	}

	function compositeTransition(oldImage, bg, currentG, gWidth, vOffset) {
		var newImage = compositeG(bg, currentG, gWidth, vOffset);
		var interval = c.shittyTransition(oldImage, newImage, 0.5);
		console.log(interval);
		lock = false;
		return newImage;
	}

	function compareG(g1, g2) {
		switch (g1.name < g2.name) {
			case false:
				return 1;
			case true: 
				return -1;
		}
	}

	function toggleG(currentG, toggledG) {
		for(i in currentG) {
			if (currentG[i].name == toggledG) {
				currentG.splice(i, 1);
				return;
			}
		}
		currentG.push({name: toggledG, byteArray: g[toggledG]});
		currentG.sort(compareG);
	}

	function toggleRender(toggledG) {
		lock = true;
		toggleG(currentG, toggledG);
		currentImage = new Uint8Array(compositeTransition(currentImage, currentBg, currentG, 120, 5));
	}

	function switchBg(bgName) {
		lock = true;
		currentBg = bg[bgName];
		currentImage = new Uint8Array(compositeTransition(currentImage, currentBg, currentG, 120, 5));
	}

	bg = {};
	g = {};
	rendered = {};
	loadImage('bg1', bg, function(){
		c.renderCanvas(bg['bg1']);
		currentImage = bg['bg1'];
		currentBg = bg['bg1'];
		currentG = new Array();
	});
	loadImage('bg2', bg);
	loadImage('bg4', bg);
	loadImage('bg5', bg);
	loadImage('bgs', bg);
	loadImage('g1', g);
	loadImage('g2', g);
	loadImage('g3', g);
	loadImage('g4', g);
	loadImage('g5', g);

	lock = false;

	window.onkeydown = function(e){
		if (lock === false) {
			switch(e.keyCode){
				case 49:
					switchBg('bg1');
					break;
				case 50:
					switchBg('bg2');
					break;
				case 51:
					switchBg('bg4');
					break;
				case 52:
					switchBg('bg5');
					break;
				case 53:
					switchBg('bgs');
					break;
				case 54:
					toggleRender('g1');
					break;
				case 55:
					toggleRender('g2');
					break;
				case 56:
					toggleRender('g3');
					break;
				case 57:
					toggleRender('g4');
					break;
				case 48:
					toggleRender('g5');
					break;
			}
		}
	};
	</script>
</head>
<body>
	<div id="girls">
		<pre></pre>
	</div>
</body>
</html>